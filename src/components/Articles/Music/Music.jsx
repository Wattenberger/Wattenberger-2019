import { useState, usePrevious, useEffect } from 'react';
import React, {Component} from "react"
import PropTypes from "prop-types"
import numeral from "numeral"
import domToImage from "dom-to-image"
import * as d3 from "d3"
import classNames from "classnames"
import _ from "lodash"
import Tooltip from "components/_ui/Tooltip/Tooltip"
import Button from "components/_ui/Button/Button"
import Chart from "components/_ui/Chart/Chart"
import Scatter from "components/_ui/Chart/Scatter/Scatter"
import Axis from "components/_ui/Chart/Axis/Axis"
import RadioGroup from "components/_ui/RadioGroup/RadioGroup"
import Slider from 'rc-slider';
import 'rc-slider/assets/index.css';
import pieces from "./emotion"
import './Music.scss';
console.log(pieces[0])


const pieceNames = ["cello_ma_1-1", "cello_maisky_1-1", "cello_rostropovich_1-1", "violin_bell", "violin_ehnes", "violin_heifetz", "violin_perlman", "violin_zimmerman"]
const emoji = {
  DISGUSTED: "ü§¢",
  SURPRISED: "üòÆ",
  ANGRY: "üò°",
  HAPPY: "üòÄ", //üôÇ
  CALM: "üòê",
  SAD: "üò∞",
  CONFUSED: "üòï",
}

const eyesClosedIcon = <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-eye-off"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line></svg>
const formatNumber = d => numeral(d).format("0,0a")
const formatNumberWithDecimal = d => numeral(d).format("0,0.0a")
const ordinalColors = ["#c7ecee", "#778beb", "#f7d794", "#63cdda", "#cf6a87", "#e77f67", "#786fa6", "#FDA7DF", "#4b7bec", "#778ca3"];

const instrumentColors = {
  violin: "#778beb",
  cello: "#e77f67",
}
const colorScale = d3.scaleLinear().range(["#c7ecee", "#686de0"]).domain([0, 1])
const formatPieceName = str => _.startCase(str.split("_")[1])
const pieceOptions = _.map(pieceNames, (piece, index) => ({
  value: piece,
  label: formatPieceName(piece),
  color: instrumentColors[pieces[index].instrument],
}))
const Music = () => {
  const [pieceName, setPieceName] = useState(pieceNames[0])
  const data = _.find(pieces, {name: pieceName})
  return (
    <div className="Music">
      <h2 className="Music__title">
        Classical Music
      </h2>
      <div className="Music__contents">
        <h3>Performances</h3>
        <RadioGroup
          value={pieceName}
          options={pieceOptions}
          onChange={d => setPieceName(d.value)}
        />

        <div className="Music__description">
          <p>
            <b>How do different musicians emote while performing?</b> We've laid out <b>{ formatPieceName(pieceName) }</b>'s emotions during their <b style={{color: instrumentColors[data.instrument]}}>{ data.instrument }</b> performance. Each measure lasts for two seconds and each "note" is a prominent facial expression -- higher on the scale when looking up and lower when looking down.
          </p>
          <p>
            The expressions we looked for were { _.map(emoji, (emoji, expression) => `${expression == "CONFUSED" ? ",  and" : expression == "DISGUSTED" ? "" : ", "}  ${emoji} ${_.lowerCase(expression)}`)}.
          </p>
          <p>
            Musicians also emote with other facial expressions, such as closing their eyes ({ eyesClosedIcon }) and raising their eyebrows (‚åí). Run through the piece and see if you can find their idiosyncracies.
          </p>
        </div>
        <MusicStaff data={data} />
        {/* {_.map(pieces, piece => (
          <div className="Music__piece" key={piece.name}>
            <h3>{ piece.name }</h3>
            <MusicStaff data={piece} />
          </div>
        ))} */}
        <div className="Music__radars">
          {_.map(pieces, piece => (
            <div className="Music__radar" key={piece.name}>
              <h3 className="Music__radar__title">
                <div style={{stroke: instrumentColors[piece.instrument]}}>{ icons[piece.instrument ]}</div>
                <div>{ formatPieceName(piece.name) }</div>
              </h3>
              <MusicRadar data={[piece]} />
            </div>
          ))}
          <div className="Music__radar">
              <h3 className="Music__radar__title">
                <div style={{display: "flex", alignItems: "center"}}>
                  <div style={{stroke: instrumentColors["cello"]}}>{ icons["cello"]}</div>
                  <div style={{stroke: instrumentColors["violin"]}}>{ icons["violin"]}</div>
                </div>
                <div>All</div>
              </h3>
            <MusicRadar data={pieces} />
          </div>
        </div>
      </div>

      <div className="Music__attribution">
        This is a preliminary exploration of the data. Future exploration could involve "playing" the in time with the video, making the emoji look like real notes (grace note, whole note, etc), a birds-eye-view of all musicians. We plan on analyzing lots more pieces to get a bigger picture.
        <br />
        <i>Violin & cello icons by ATOM from the Noun Project</i>
      </div>
    </div>
  )
}

export default Music

// const getTopExpression = expressions => (_.first(_.filter(
//   _.orderBy(
//     expressions, "Confidence", "desc"
//   ),
//   d => d.Confidence > 0.5
// )) || {}).Type
// const timeAccessor = d => d.time
// const expressionAccessor = d => d.expression
// const headPitchAccessor = d => d.headPitch
// const emotions = _.filter(emotion.map(d => ({
//   time: d.Timestamp,
//   expression: getTopExpression(d.Face.Emotions),
//   headPitch: d.Face.Pose.Pitch,
// })), expressionAccessor)

// const eyesClosed = _.filter(emotion.map(d => ({
//   eyesAreClosed: d.Face.EyesOpen && !d.Face.EyesOpen.Value && d.Face.EyesOpen.Confidence > 0.9,
//   time: d.Timestamp,
// })), "eyesAreClosed")

// const getLandmark = (d, landmark) => _.first(_.filter(d.Face.Landmarks, d => d.Type == landmark)) || {}
// const getEyebrowDistance = d => getLandmark(d, "leftEyeBrowLeft").Y - getLandmark(d, "eyeLeft").Y
// const eyebrowMean = d3.mean(emotion.map(getEyebrowDistance))
// const eyebrowStandardDeviation = d3.deviation(emotion.map(getEyebrowDistance))
// const eyebrowRaises = _.filter(emotion.map(d => (
//   getEyebrowDistance(d) > (eyebrowMean + eyebrowStandardDeviation) ? d.Timestamp : null
// )))

const icons = {
  // violin: <svg x="0px" y="0px" width="100" height="125" viewBox="0 0 100 125" enableBackground="new 0 0 100 100"><g><path d="M62.933,74.837c-1.004-1.86-0.253-3.151-0.212-3.219c0.179-0.285,0.157-0.652-0.054-0.916   c-0.213-0.266-0.573-0.365-0.893-0.248c-0.012,0.004-1.192,0.428-2.156-0.066c-0.564-0.289-0.974-0.862-1.218-1.704   c-0.531-3.447-0.437-5.812,0.271-6.84c0.394-0.573,1.135-0.501,1.859-0.379c0.085,0.014,0.16,0.027,0.225,0.036   c0.305,0.041,0.612-0.1,0.778-0.359c0.277-0.434,0.026-0.828-0.057-0.957c-0.166-0.261-0.608-0.954-0.448-2.028   c0.071-0.478,0.166-0.689,0.309-1.01c0.271-0.606,0.608-1.359,0.869-3.829c0.302-2.857-0.344-5.239-1.919-7.077   c-2.276-2.656-5.827-3.388-7.321-3.583l-0.422-20.371h1.066c0.011,0.025,0.022,0.051,0.034,0.076   c0.209,0.407,0.604,0.64,1.084,0.64c0.831,0,1.508-0.676,1.508-1.508c0-0.831-0.676-1.508-1.508-1.508   c-0.481,0-0.876,0.233-1.084,0.64c-0.013,0.025-0.023,0.05-0.034,0.076H52.51l-0.052-2.507h1.071   c0.011,0.025,0.022,0.051,0.034,0.076c0.209,0.407,0.604,0.64,1.084,0.64c0.831,0,1.508-0.676,1.508-1.508   c0-0.831-0.676-1.508-1.508-1.508c-0.481,0-0.876,0.233-1.084,0.64c-0.013,0.025-0.023,0.05-0.034,0.076h-1.104l-0.024-1.15   c0.621-0.423,1.311-1.206,1.311-2.353c0-1.153-0.878-1.386-1.253-1.485c-0.224-0.059-0.321-0.091-0.382-0.164   c-0.062-0.074-0.206-0.329-0.206-1.084c0-1.148-0.267-1.948-0.793-2.383l0.005-0.008c-0.013-0.009-0.041-0.026-0.079-0.048   c-0.057-0.042-0.117-0.081-0.18-0.115C50.544,7.67,50.26,7.624,50,7.635c-0.26-0.01-0.544,0.035-0.825,0.186   c-0.063,0.034-0.122,0.074-0.18,0.116c-0.039,0.022-0.066,0.04-0.079,0.048c-0.119,0.078-0.21,0.183-0.27,0.301   c-0.344,0.465-0.518,1.163-0.518,2.09c0,0.756-0.144,1.01-0.206,1.084c-0.061,0.073-0.158,0.104-0.382,0.164   c-0.375,0.1-1.253,0.333-1.253,1.485c0,1.147,0.689,1.93,1.311,2.353l-0.053,2.582h-1.119c-0.011-0.025-0.022-0.051-0.034-0.076   c-0.209-0.407-0.604-0.64-1.084-0.64c-0.831,0-1.508,0.676-1.508,1.508c0,0.831,0.676,1.508,1.508,1.508   c0.481,0,0.876-0.233,1.084-0.64c0.013-0.025,0.023-0.05,0.034-0.076h1.086l-0.052,2.507h-1.114   c-0.011-0.025-0.021-0.051-0.034-0.075c-0.209-0.407-0.604-0.64-1.084-0.64c-0.831,0-1.508,0.676-1.508,1.507   c0,0.831,0.676,1.508,1.508,1.508c0.481,0,0.876-0.233,1.084-0.64c0.013-0.025,0.023-0.05,0.034-0.076h1.081l-0.392,18.939   c-1.494,0.195-5.046,0.927-7.321,3.583c-1.575,1.839-2.221,4.22-1.919,7.077c0.261,2.47,0.598,3.223,0.869,3.829   c0.143,0.32,0.238,0.532,0.309,1.01c0.16,1.074-0.282,1.767-0.448,2.028c-0.083,0.129-0.334,0.524-0.057,0.957   c0.166,0.26,0.473,0.401,0.779,0.359c0.064-0.009,0.139-0.021,0.224-0.036c0.724-0.122,1.464-0.193,1.859,0.379   c0.708,1.028,0.801,3.393,0.271,6.84c-0.244,0.842-0.653,1.415-1.218,1.704c-0.964,0.494-2.144,0.071-2.152,0.068   c-0.319-0.121-0.681-0.023-0.896,0.243c-0.215,0.266-0.235,0.639-0.05,0.927c0.008,0.013,0.797,1.333-0.217,3.211   c-0.679,1.258-2.805,7.376,0.046,12.155c2.128,3.567,6.401,5.375,12.699,5.375c0.065,0,0.127-0.009,0.187-0.023   c0.06,0.015,0.123,0.023,0.187,0.023c6.298,0,10.571-1.808,12.699-5.375C65.738,82.213,63.612,76.095,62.933,74.837z    M50.482,62.707h-0.964h-1.314l0.767-37.054h2.058l0.767,37.054H50.482z M47.947,13.154c0.917-0.244,1.765-0.749,1.765-2.778   c0-0.732,0.125-1.022,0.186-1.12c0.034-0.013,0.07-0.024,0.102-0.031c0.031,0.007,0.066,0.017,0.101,0.031   c0.061,0.098,0.187,0.387,0.187,1.12c0,2.03,0.848,2.535,1.765,2.778c0.023,0.006,0.049,0.013,0.074,0.02   c-0.043,0.741-0.808,1.09-0.835,1.102c-0.299,0.126-0.49,0.422-0.483,0.746l0.133,6.416c-0.001,0.019-0.003,0.038-0.003,0.057   c0,0.032,0.002,0.063,0.006,0.093l0.051,2.48h-1.992l0.187-9.047c0.007-0.324-0.185-0.62-0.483-0.746   c-0.008-0.003-0.791-0.355-0.835-1.102C47.898,13.167,47.924,13.16,47.947,13.154z M49.276,83.092   c-0.383-0.626-0.64-2.221-0.702-4.273c0.195,0.019,0.399,0.027,0.606,0.027c0.272,0,0.549-0.015,0.82-0.037   c0.271,0.022,0.548,0.037,0.82,0.037c0.216,0,0.428-0.009,0.629-0.029c0,2.228-0.189,3.666-0.561,4.275   c-0.269,0.44-0.628,1.41-0.646,4.741c-0.007,1.226,0.036,2.357,0.063,2.949c-0.039,0-0.078,0.001-0.117,0.001   c-0.065,0-0.127,0.009-0.187,0.023c-0.06-0.015-0.123-0.023-0.187-0.023c-0.036,0-0.071-0.001-0.106-0.001   c0.043-0.598,0.112-1.718,0.134-2.931C49.9,84.512,49.547,83.536,49.276,83.092z M61.527,86.18c-1.635,2.74-4.875,4.268-9.64,4.553   c-0.143-2.843-0.054-6.15,0.353-6.815c0.397-0.65,0.845-1.892,0.789-5.767c-0.002-0.129-0.004-0.235-0.004-0.312   c0-0.036-0.003-0.07-0.008-0.105c0.002-0.02,0.005-0.04,0.007-0.06c0.024-0.437-0.31-0.81-0.747-0.834   c-0.297-0.015-0.565,0.133-0.714,0.368c-0.158,0.033-0.42,0.049-0.728,0.048c-0.135-0.067-0.29-0.097-0.451-0.077   c-0.126,0.016-0.255,0.029-0.384,0.04c-0.129-0.011-0.258-0.024-0.384-0.04c-0.16-0.02-0.315,0.01-0.45,0.077   c-0.308,0.001-0.57-0.015-0.729-0.048c-0.148-0.235-0.416-0.384-0.714-0.368c-0.437,0.024-0.771,0.398-0.747,0.834   c0.001,0.02,0.004,0.04,0.007,0.06c-0.005,0.034-0.008,0.069-0.008,0.105c0,2.065,0.165,4.796,0.949,6.079   c0.404,0.661,0.416,3.973,0.199,6.816c-4.771-0.284-8.014-1.812-9.65-4.554c-1.261-2.114-1.321-4.578-1.15-6.273   c0.202-1.997,0.791-3.677,1.137-4.319c0.73-1.353,0.786-2.53,0.651-3.383c0.593,0.023,1.299-0.057,1.976-0.399   c0.992-0.502,1.682-1.423,2.05-2.739c0.008-0.03,0.015-0.061,0.02-0.092c0.628-4.046,0.461-6.598-0.524-8.028   c-0.604-0.878-1.464-1.12-2.211-1.147c0.173-0.603,0.212-1.23,0.116-1.875c-0.103-0.693-0.269-1.064-0.43-1.424   c-0.225-0.503-0.505-1.129-0.739-3.348c-0.254-2.404,0.265-4.38,1.541-5.874c1.8-2.108,4.695-2.796,6.092-3.013l-0.398,19.217   c-0.004,0.213,0.077,0.418,0.226,0.57s0.353,0.238,0.566,0.238h2.122h0.964h2.122c0.213,0,0.417-0.086,0.566-0.238   c0.149-0.152,0.23-0.358,0.226-0.57l-0.398-19.219c1.393,0.213,4.277,0.896,6.086,3.007c1.281,1.495,1.801,3.474,1.547,5.881   c-0.234,2.219-0.514,2.845-0.739,3.348c-0.161,0.359-0.327,0.731-0.43,1.424c-0.096,0.646-0.057,1.273,0.116,1.875   c-0.746,0.027-1.607,0.27-2.211,1.147c-0.985,1.431-1.152,3.982-0.524,8.028c0.005,0.031,0.011,0.062,0.02,0.092   c0.368,1.316,1.058,2.238,2.05,2.739c0.677,0.342,1.383,0.422,1.976,0.399c-0.135,0.853-0.079,2.031,0.652,3.383   c0.346,0.642,0.935,2.322,1.137,4.319C62.848,81.602,62.788,84.066,61.527,86.18z"/><path d="M53.418,70.17c0.003-0.127,0.01-0.424-0.235-0.679c-0.247-0.257-0.543-0.261-0.703-0.264   c-0.737-0.011-1.284-0.023-1.691-0.034c-0.14-0.059-0.297-0.078-0.452-0.049c-0.033,0.003-0.123,0.011-0.337,0.021   c-0.214-0.01-0.304-0.018-0.337-0.021c-0.156-0.029-0.313-0.01-0.453,0.049c-0.406,0.011-0.953,0.023-1.69,0.034   c-0.159,0.002-0.455,0.007-0.702,0.264c-0.245,0.255-0.238,0.552-0.235,0.679c0.002,0.094,0.006,0.268-0.109,0.673   c-0.107,0.374-0.036,0.75,0.2,1.058c0.365,0.478,1.084,0.747,2.331,0.874c0.084,0.009,0.167,0.016,0.248,0.023   c0.08,0.029,0.165,0.045,0.255,0.047c0.006,0,0.037,0.001,0.089,0.001c0.085,0,0.227-0.001,0.404-0.006   c0.178,0.005,0.319,0.006,0.404,0.006c0.052,0,0.083,0,0.089-0.001c0.09-0.001,0.175-0.018,0.255-0.047   c0.081-0.007,0.164-0.014,0.248-0.023c1.247-0.127,1.966-0.396,2.331-0.874c0.236-0.308,0.306-0.683,0.199-1.058   C53.411,70.438,53.415,70.263,53.418,70.17z M50.003,71.256c-0.791-0.024-1.57-0.13-1.933-0.263   c0.016-0.068,0.029-0.131,0.04-0.191c0.922-0.016,1.509-0.033,1.891-0.051c0.381,0.018,0.968,0.035,1.891,0.051   c0.011,0.06,0.024,0.123,0.04,0.191C51.568,71.125,50.793,71.231,50.003,71.256z"/></g></svg>,
  violin: <svg width="50" height="62.5" viewBox="0 0 50 62.5"><path d="M46.5464478,2.9562988c-0.0536499-0.4975586-0.4667358-0.8788452-0.96698-0.8924561l-2.5740356-0.0703125  c-0.0092163-0.0002441-0.0183716-0.0003662-0.0275269-0.0003662c-0.4493408,0-0.8450928,0.3004761-0.9642944,0.7360229  l-0.5174561,1.890625l-0.8428955,0.8627319l-0.557373-0.5136108c0.0361328-0.2756958-0.041748-0.5623779-0.2617798-0.7651367  c-0.3596191-0.3314209-0.9197388-0.3085327-1.2510986,0.0510864c-0.3314209,0.3595581-0.3085327,0.9197388,0.0510864,1.2510986  c0.2200928,0.2028809,0.512207,0.257019,0.7841797,0.1984253l0.5358887,0.4937744l-0.8303833,0.8498535l-0.510376-0.4702759  c0.0361938-0.2757568-0.041626-0.562561-0.2617188-0.7653809c-0.3595581-0.3313599-0.9197388-0.3084717-1.2510986,0.0510864  c-0.3313599,0.3596191-0.3085327,0.9197998,0.0510864,1.2511597c0.2200317,0.2027588,0.512085,0.256897,0.7839355,0.1984253  l0.4890137,0.4506226l-8.7805176,8.9873657c-1.3379517-0.8981323-3.1307373-1.7820435-5.0042725-1.7821045  c-0.5812988,0-1.1459961,0.0858154-1.6783447,0.255188c-2.0846558,0.6630249-3.8101196,2.875-5.0700073,4.4901123  l-0.1192627,0.152832c-0.8137207,1.041687-1.2948608,1.2885742-1.3781128,1.3256836  c-0.3543091,0.0779419-0.6422729,0.3436279-0.7451782,0.6976318c-0.1133423,0.3903198,0.020752,0.8104248,0.3393555,1.0628052  c0.2709351,0.2180786,0.7047119,0.6925659,0.7662354,1.0110474c0.1257935,0.6519165-0.3938599,1.4002075-1.5888062,2.2875977  c-0.4961548,0.3684692-1.4994507,0.7806396-2.0994263,0.7806396c-0.1443481,0-0.1987305-0.024353-0.1992188-0.0245972  c-0.3104858-0.2230225-0.5136719-0.7581177-0.5465698-0.8781738c-0.1152344-0.420105-0.4890747-0.7172852-0.9243164-0.7347412  c-0.0134888-0.0004883-0.0269775-0.0007935-0.0403442-0.0007935c-0.4192505,0-0.7959595,0.2623291-0.9398804,0.6591797  c-0.1046753,0.2839966-0.4864502,1.114502-0.9790039,1.5125122c-0.1520386,0.1228638-0.5457153,0.2915649-0.9265137,0.4547729  c-1.2108765,0.5188599-3.0407715,1.3029785-4.2844849,3.3253784c-1.3804932,2.2446289-1.2501831,5.3146362-0.508667,7.3614502  c1.4442749,3.9865112,5.3343506,7.5805054,9.6799316,8.9432373c0.7429199,0.2329712,1.5970459,0.3560791,2.4700317,0.3560791  c1.831604,0,3.6036377-0.52948,4.8618774-1.4526367c1.9141846-1.40448,2.5465698-3.2922363,2.9649658-4.5413818  c0.1315918-0.3927612,0.2676392-0.7989502,0.3776855-0.9605103c0.3565063-0.5233765,1.1530762-0.9716187,1.4299316-1.1001587  c0.3942261-0.1830444,0.6262817-0.6003418,0.5723267-1.0316162c-0.053894-0.4312744-0.3789673-0.7788696-0.8060913-0.8592529  c-0.1574707-0.0319824-0.6815186-0.1929321-0.9292603-0.4859619c-0.1633301-0.2930298,0.1052246-1.5847778,0.5756226-2.3398438  c0.7446899-1.1953735,1.4093628-1.7764893,2.0319824-1.7765503c0.0389404,0,0.0783691,0.0021973,0.1184692,0.0065308  c0.3370361,0.0369263,0.8717041,0.4689941,1.0700684,0.6812134c0.1928101,0.2062988,0.4589844,0.3172607,0.730835,0.3172607  c0.1195068,0,0.2401123-0.0214844,0.3561401-0.0656738c0.3444824-0.1314087,0.5857544-0.4400635,0.6345215-0.7995605  c0.0302124-0.0859985,0.2370605-0.5856323,1.2089233-1.4816284l0.1426392-0.1313477  c1.506958-1.3873901,3.5708618-3.2874146,4.0617676-5.4191895c0.5653687-2.4551392-0.6896973-4.8057251-2.0558472-6.5197754  l8.7039795-10.0412598l0.425354,0.3919067c-0.0361328,0.2756958,0.041687,0.5623779,0.2617188,0.7651978  c0.3596191,0.3313599,0.9197998,0.3084717,1.2511597-0.0510864c0.3313599-0.3596191,0.3084717-0.9197998-0.0510864-1.2511597  c-0.2200928-0.2028198-0.5123291-0.257019-0.7842407-0.1984253l-0.4475708-0.4124756l0.7780762-0.897644l0.4743652,0.4367676  c-0.0361938,0.2757568,0.041626,0.562561,0.2617188,0.7653809c0.3596191,0.3313599,0.9197388,0.3085327,1.2510986-0.0510864  c0.3314209-0.3596191,0.3085327-0.9197388-0.0510864-1.2511597c-0.2200317-0.2027588-0.512085-0.256897-0.7839355-0.1984253  l-0.4968262-0.4574585l0.3193359-0.3684082l1.8427124-0.6680908c0.4329834-0.1569824,0.7026978-0.5894165,0.6533813-1.0473022  L46.5464478,2.9562988z M11.1030273,42.4594727c0.0083008,0.1923828,0.0166016,0.3740234-0.0053711,0.5107422  c-0.1474609,0.902832-0.6850586,1.4667969-1.4306641,1.4433594c-0.194397-0.006958-0.4335938-0.1226807-0.6879883-0.2849731  c-1.9567261-1.5724487-3.4634399-3.5591431-4.2398682-5.5768433c-0.0999756-0.3383789-0.1445313-0.6526489-0.0970459-0.9072266  c0.0395508-0.2099609,0.1396484-0.3623047,0.3061523-0.4658203c0.6289063-0.3901367,1.1948242-0.5483398,1.7036133-0.5483398  c1.4511719,0,2.4379883,1.2856445,3.0966797,2.1430664c0.4101563,0.534668,0.6586914,0.859375,0.9711914,0.659668  c0.7016602-0.4492188,1.5541992-1.1523438,2.5610352-2.9619141c0.7133789-1.2817383,1.2202148-1.9892578,1.4614258-2.2993164  l2.3198242,2.1381836c-0.2817383,0.3027344-0.9624023,0.9707031-2.1269531,1.7402344  c-0.7070313,0.4667969-2.4018555,1.6459961-3.1303711,2.309082C11.0395508,41.0566406,11.0761719,41.8676758,11.1030273,42.4594727z   M34.295166,26.342041c-0.435791,1.8924561-2.4798584,3.7234497-3.9077148,5.0397339  c-1.5061035,1.3884888-1.5220337,2.0820313-1.5220337,2.0820313s-0.8403931-0.899231-1.6918335-0.9924316  c-0.0770264-0.0084229-0.15271-0.0125122-0.227356-0.0125122c-1.3123779,0.0001221-2.2653809,1.2600708-2.8807373,2.2478027  c-0.5199585,0.8345947-1.1253662,2.7633057-0.4904175,3.5142212c0.5422363,0.6413574,1.5079346,0.8230591,1.5079346,0.8230591  s-1.2399292,0.5678101-1.8376465,1.4453125c-0.6308594,0.9260254-0.7459106,3.5256348-3.1078491,5.258606  c-1.1668091,0.8561401-2.7647095,1.2589111-4.2702637,1.2589111c-0.7713013,0-1.5183716-0.1057129-2.1708374-0.3103027  c-1.3184204-0.4134521-2.5499268-1.0494385-3.6794434-1.8106079c0.8065796-0.1359253,1.4082642-0.8181763,1.5738525-1.8355713  c0.0307617-0.1879883,0.0214844-0.3945313,0.0117188-0.6132813c-0.0249023-0.5478516-0.0532227-1.168457,0.5390625-1.7075195  c0.706543-0.644043,2.3730469-1.8022461,3.0688477-2.262207c1.6591797-1.0961914,2.3676758-1.9838867,2.3969727-2.0209961  l0.1430664-0.1816406l-3.0478516-2.809082l-0.1694336,0.1835938c-0.0253906,0.0273438-0.6367188,0.6977539-1.6889648,2.5888672  c-0.9086914,1.6323242-1.6445313,2.2885742-2.3032227,2.7246094c-0.0961914-0.0932617-0.2597656-0.3061523-0.3959961-0.4838867  c-0.8613281-1.1210938-2.6523438-3.4541016-5.4604492-1.7148438c-0.1483154,0.0921021-0.265564,0.2097168-0.3556519,0.3482056  c-0.3168945-1.7243042-0.1624146-3.7505493,0.7488403-5.2322388c1.5346069-2.4954224,4.1162109-2.8219604,4.9877319-3.5262451  c0.8258057-0.6672974,1.2905884-1.9494629,1.2905884-1.9494629s0.2599487,0.9477539,0.9432983,1.4358521  c0.1999512,0.1428223,0.4667358,0.2024536,0.7669067,0.2024536c0.9014282,0,2.1033936-0.5379639,2.6956787-0.9777832  c0.9873657-0.7333374,2.2471313-1.8671818,1.9744263-3.2800293c-0.1623535-0.8409424-1.1271362-1.6052856-1.1271362-1.6052856  s0.6900024-0.0723877,1.9509888-1.6867065c1.1954956-1.5304565,2.8536987-3.71698,4.7044067-4.305603  c0.4552612-0.1448364,0.9164429-0.2081299,1.3751221-0.2081299c1.7825317,0.000061,3.5198364,0.954895,4.7165527,1.8006592  l-8.9735107,9.4608765l3.1303711,2.8847656l8.7141113-9.689209C33.40625,21.8399048,34.8164063,24.0784302,34.295166,26.342041z   M31.8978882,20.0380249c0.0009155,0.0010376,0.0019531,0.0023193,0.0028687,0.0033569l-8.4207764,9.362915l-2.3852539-2.1982422  l8.8295898-9.3095703l-0.0006104-0.0006104L42.0769653,5.4562988l1.368042,1.2605591L31.8978882,20.0380249z M43.7928467,6.3569336  l-1.3858643-1.2769775l0.571167-2.086792l2.5740356,0.0703125l0.2755127,2.5556641L43.7928467,6.3569336z M22.6286621,31.1273804  c0.4917603,0.3865356,0.5230103,1.0152588,0.335022,1.6401978c-0.3392944,1.1279907-2.343689,2.1454468-2.7307739,3.6765747  c-0.0783081,0.3095703-0.1217041,0.99646,0.1574097,1.1516113c0.2315674,0.1286011,0.4013062,0.0701904,0.4996338,0.012207  c-0.1286011-0.137085-0.1351929-0.3499756-0.0057983-0.4903564c0.135376-0.1469116,0.3641968-0.156311,0.5111694-0.020874  c0.1387939,0.1278687,0.1501465,0.3372192,0.0373535,0.4840088l0.0057373,0.0004883c0,0-0.3792725,0.8828125-1.2247314,0.4147339  c-0.4069824-0.2254028-0.8172607-0.7305908-0.6864014-1.6368408c0.1654053-1.1454468,1.7626953-2.5725098,2.6137085-3.5480347  c0.281189-0.3223267,0.7201538-0.8134766,0.3012695-1.3222656c-0.0837402-0.1016846-0.1695557-0.1377563-0.249939-0.1549683  c0.0354614,0.1182861,0.0152588,0.2504883-0.0745239,0.3479614c-0.135376,0.1468506-0.3643188,0.15625-0.5111694,0.020874  c-0.1469727-0.135437-0.15625-0.3643188-0.020874-0.5112305c0.0443726-0.0481567,0.1000977-0.0759277,0.1583862-0.0942383  l-0.0032959-0.0046997C21.7408447,31.0925293,22.2961426,30.8660278,22.6286621,31.1273804z M17.6416016,28.6647339  c-0.9028931,0.9277954-2.1950073,2.6361084-3.3231201,2.8943481c-0.8925781,0.2043457-1.4295044-0.1633911-1.6873169-0.5506592  c-0.5355225-0.8045044,0.3134155-1.2545166,0.3134155-1.2545166l0.0009766,0.0057373  c0.137146-0.1243896,0.3466797-0.130127,0.4854736-0.0022583c0.1469727,0.135437,0.15625,0.3642578,0.020874,0.5111694  c-0.1293945,0.1403809-0.3421021,0.1511841-0.4891968,0.0342407c-0.0498047,0.1026611-0.0941772,0.2766724,0.0529175,0.4969482  c0.1773071,0.2655029,0.8584595,0.1662598,1.1605835,0.0629883c1.4944458-0.5106201,2.3450928-2.5913086,3.4416504-3.0214844  c0.6075439-0.2382813,1.2367554-0.2584229,1.6620483,0.2001343c0.2875977,0.3101196,0.1071777,0.882019,0.1071777,0.882019  l-0.0049438-0.0028687c-0.0135498,0.0595703-0.0366821,0.1173706-0.0810547,0.1655884  c-0.135376,0.1469116-0.3642578,0.156311-0.5111694,0.020874c-0.1469116-0.135376-0.15625-0.3642578-0.020874-0.5111694  c0.0897827-0.0974731,0.2198486-0.1283569,0.3406982-0.1027222c-0.0237427-0.0786743-0.0666504-0.1612549-0.1748657-0.2363892  C18.3936157,27.8806763,17.9399414,28.3582153,17.6416016,28.6647339z M20.4269409,33.4612427l-3.088623-2.8462524  l0.6063232-0.1968384l2.5790405,2.3766479L20.4269409,33.4612427z"/></svg>,
  // piano: <svg width="100" height="125" viewBox="0 0 100 125" style="enable-background:new 0 0 100 100;"><g><g><g><path d="M92.9,95H7.1C5.9,95,5,94.1,5,92.9V18.4c0-1.2,0.9-2.1,2.1-2.1h14.8c1.2,0,2.1,0.9,2.1,2.1v54.1h12.5V18.4     c0-1.2,0.9-2.1,2.1-2.1h22.9c1.2,0,2.1,0.9,2.1,2.1v54.1H76V18.4c0-1.2,0.9-2.1,2.1-2.1h14.8c1.2,0,2.1,0.9,2.1,2.1v74.5     C95,94.1,94.1,95,92.9,95z M9.2,90.8h81.6V20.5H80.2v54.1c0,1.2-0.9,2.1-2.1,2.1H61.4c-1.2,0-2.1-0.9-2.1-2.1V20.5H40.7v54.1     c0,1.2-0.9,2.1-2.1,2.1H21.9c-1.2,0-2.1-0.9-2.1-2.1V20.5H9.2V90.8z"/></g></g><g><g><rect x="21.9" y="7.1" width="16.7" height="67.5"/></g></g><g><g><rect x="61.4" y="7.1" width="16.7" height="67.5"/></g></g><g><g><path d="M38.6,76.7H21.9c-1.2,0-2.1-0.9-2.1-2.1V7.1c0-1.2,0.9-2.1,2.1-2.1h16.7c1.2,0,2.1,0.9,2.1,2.1v67.5     C40.7,75.8,39.7,76.7,38.6,76.7z M24,72.5h12.5V9.2H24V72.5z"/></g></g><g><g><path d="M78.1,76.7H61.4c-1.2,0-2.1-0.9-2.1-2.1V7.1c0-1.2,0.9-2.1,2.1-2.1h16.7c1.2,0,2.1,0.9,2.1,2.1v67.5     C80.2,75.8,79.3,76.7,78.1,76.7z M63.5,72.5H76V9.2H63.5V72.5z"/></g></g><g><g><path d="M30.2,95c-1.2,0-2.1-0.9-2.1-2.1V74.6c0-1.2,0.9-2.1,2.1-2.1c1.2,0,2.1,0.9,2.1,2.1v18.3C32.3,94.1,31.4,95,30.2,95z"/></g></g><g><g><path d="M69.8,95c-1.2,0-2.1-0.9-2.1-2.1V74.6c0-1.2,0.9-2.1,2.1-2.1s2.1,0.9,2.1,2.1v18.3C71.9,94.1,70.9,95,69.8,95z"/></g></g></g></svg>,
  piano: <svg width="50" height="62.5" viewBox="0 0 50 62.5"><path d="M40.934082,22.2050781c-0.633606-0.1488647-1.5811768-0.425415-2.4584961-0.720459l-4.9733276-8.6916504  c0.7653809-0.6738892,1.170105-1.1240234,1.3189087-1.3039551c0.3085938-0.3021851,0.4570923-0.7266235,0.4003906-1.1613159  c-0.0632324-0.4849854-0.3688965-0.8928833-0.817627-1.0912476c-0.126709-0.0559692-0.2783813-0.1361084-0.4083862-0.2116699  c0.1289063-0.1923218,0.3328247-0.463501,0.5322876-0.7286987l0.1517334-0.2019653  c0.6602173-0.880249,1.2557373-1.5827026,1.9309692-2.2775269c0.4571533-0.470459,1.4890137-1.2230835,2.043396-1.6274414  l0.3025513-0.2220459c0.3833008-0.2863159,0.5686646-0.7564087,0.4837036-1.2267456  c-0.0853882-0.4726563-0.425354-0.8501587-0.8873291-0.9851074l-2.7479858-0.6866455l-0.4746704-0.1184082l-0.3848267,0.302002  L11.2007446,19.887207l-0.6710205,0.5266724l0.1588745,0.2860107l-4.6870117,1.6453857l-0.8604736,0.302063l0.2218018,0.8849487  c0.3258057,1.2998657,0.4879761,2.8027344,0.3477783,3.1962891c-0.5551147,0.706543-1.0281982,0.9111938-1.3374634,1.0036011  c-0.6623535,0.1977539-1.0948486,0.8118286-1.0647583,1.5029907l-0.0013428,2.5323486l-0.0004272,0.7911987l0.7698364,0.1824341  L9.81073,34.0997925l1.1945801,5.9053345l-0.0258789,0.1970215c-0.243103,0.6048584-0.3955688,1.3869629,0.0820923,1.9396973  c0.3834839,0.4436646,0.9981079,0.6981201,1.6862793,0.6981201c0.7350464,0,1.3987427-0.2962646,1.7754517-0.7924194  c0.493103-0.6495972,0.1787109-1.5013428-0.1860962-2.1169434l-0.0876465-0.1817017l0.0714722-4.4858398l19.4483643,4.6765137  l0.2232056,5.2130127l0.0498047,0.5845947c-0.5473022,0.9381104-0.6687622,1.6931763-0.3606567,2.2477417  c0.3998413,0.7197266,1.4133911,0.9761963,2.2285767,0.9761963c0.4594116,0,1.097168-0.0839233,1.5266724-0.4835205  c0.1937866-0.1802979,0.7493896-0.6971436,0.0942993-2.2640381l0.2444458-0.4784546l0.0703125-0.1375122l0.0255127-0.1523438  l1.3961182-8.3376465l0.9371948-1.7814941l1.0185547-2.0015259c0.2728271-0.4751587,0.4528809-1.0632324,0.4974976-1.6578979  l0.571167-7.6040039C42.3567505,23.185791,41.7856445,22.4050903,40.934082,22.2050781z M41.2121582,23.6015015  l-3.4728394,3.9101563l-0.968689-0.0477295l3.9525146-4.2776489C40.9487305,23.2453613,41.1178589,23.4025269,41.2121582,23.6015015  z M37.2749023,32.7822266c-0.3430786,1.2807617-1.1065674,2.595459-1.3555908,3.0049438l-1.005249-0.1782837  c0.3950195-0.6881104,1.3083496-2.338501,1.4360352-3.1118164c0.2979126-1.7996216,0.1962891-3.8220215,0.1449585-4.5464478  l1.1110229,0.0546875C37.6306763,28.7597046,37.6776123,31.2774048,37.2749023,32.7822266z M7.5673828,23.8295898  l0.9203491-0.3105469l27.7491455,3.7857056l-0.2720337,0.2943726l0.0102539,0.1108398  c0.0012207,0.0126343,0.0565186,0.6316528,0.0721436,1.5068359L7.6528931,24.5264893  C7.6222534,24.2424927,7.5905762,23.9943237,7.5673828,23.8295898z M26.2680664,17.5195313  c2.4188232,0.1378784,7.8123169,0.5194702,9.2345581,1.2457886c1.4126587,0.7213135-1.7131958,1.5178223,0.5410156,2.8102417  c0.3833008,0.2197876,1.0349731,0.4799194,1.7494507,0.7307129l1.0462646,1.8284912  c0.0420532,0.0733643,0.0698128,0.1304493,0.1381836,0.2042332l-0.6386719,0.6911526l-0.5577393-0.0783691  c-0.706665-0.2532349-2.5197754-1.0906982-2.6942139-2.0196533c-0.1298828-0.6918945-0.0791016-1.1362305-0.0385742-1.4936523  c0.0546875-0.4824219,0.0981445-0.8637695-0.3950195-1.3359375c-1.1352539-1.0883789-7.9223633-1.5522461-8.6923828-1.6015625  l-0.0654297-0.0039063l-1.1049194,0.5298462c-0.7144775-0.0964355-1.4631348-0.1837158-2.2334595-0.255249L26.2680664,17.5195313z   M36.6507568,26.8569336l-5.1647949-0.7046509l1.3148193-1.3954468l5.1251221,0.7201538L36.6507568,26.8569336z   M30.2451172,20.015625c-0.9717407-0.2232056-2.6050415-0.5653687-4.5650635-0.8604126l0.3140869-0.1508179  c2.9545898,0.1928711,7.5585938,0.7358398,8.3134766,1.4594727c0.3139648,0.3007813,0.2949219,0.46875,0.2436523,0.918457  c-0.0419922,0.3696289-0.0991211,0.8759766,0.0444336,1.6416016c0.1310425,0.6983643,0.8304443,1.2779541,1.5280151,1.6948853  l-3.5094604-0.4932251l-1.4293823,1.5168457l0.2960815-4.048584C31.5385742,20.8989258,31.0185547,20.1928711,30.2451172,20.015625z   M22.4155273,19.2597656c3.3222656,0.3022461,6.2612305,0.9086914,7.7177734,1.2431641  c0.53125,0.1220703,0.8886719,0.6074219,0.8486328,1.1547852l-0.3204346,4.3820801l-16.8261108-2.2955322l0.2388306-0.1690674  l1.1240234-3.4711914c0.1333008-0.4116211,0.4951172-0.7084961,0.9223633-0.7558594  C17.3476563,19.2128906,19.7978516,19.0214844,22.4155273,19.2597656z M13.6494141,23.2626953l-0.5332031,0.3779297  l0.0043335,0.0061035l-3.5686035-0.4868164l4.6378784-1.5651245L13.6494141,23.2626953z M7.5366211,27.7319336  c0.2675781-0.5778198,0.2427368-1.7420044,0.1647339-2.6908569l28.3496094,4.6829224  c-0.00177,0.7521362-0.0397949,1.6210327-0.1577759,2.4452515l-24.510376-4.5076294l-0.0761719-0.0136719l-4.6279297,2.0610352  v0.9638672l26.7495117,5.921875v-0.7875977l2.3198242-3.0081177c-0.3024292,0.8615112-1.1097412,2.3031616-1.4448242,2.8655396  l-0.0351563,0.059082v1.559082L5.6962891,30.7387695V29.331543C6.0898438,29.1196289,7.1918945,28.4755859,7.5366211,27.7319336z   M8.078064,29.6326904l0.3415527,0.0808105l2.8666992-1.4462891l-0.0963745-0.0203857l0.1782227-0.0793457l23.9267578,4.4003906  l-2.3666992,3.0693359v0.3344727L7.1787109,30.2714844v-0.2382813L8.078064,29.6326904z M40.1743774,23.0438843  l-0.4981689,0.5390625l-0.467041-0.8162231C39.5518188,22.8701172,39.8827515,22.9658813,40.1743774,23.0438843z   M36.5410156,20.7080688c-0.1224365-0.0702515-0.2079468-0.1292114-0.2665405-0.1748047  c0.0340576-0.0472412,0.0716553-0.0966797,0.1022339-0.1368408c0.0561523-0.0737915,0.1191406-0.1589355,0.1807251-0.2496948  l0.4500732,0.786499C36.8251953,20.8535767,36.6610107,20.7768555,36.5410156,20.7080688z M35.0790405,17.5629272  c-1.6528931-0.463623-4.5200806-0.7547607-6.8076782-0.9211426c0.7884521-0.5224609,1.7406006-1.1747437,2.8453979-1.9686279  c0.6287842-0.4517822,1.1589355-0.859314,1.6087036-1.2235107L35.0790405,17.5629272z M12.1386108,21.2506714l-0.3204956-0.5767822  L35.5627441,2.0388794l2.7096558,0.6762695c0.2040405,0.0595703,0.2558594,0.3236084,0.0855713,0.4508667  c-0.4315796,0.3224487-1.8435669,1.3145142-2.4645996,1.9536743c-0.7984619,0.8216553-1.4276733,1.5929565-2.0137939,2.3744507  c-0.8686523,1.1581421-1.1480713,1.4797363-0.9317627,1.968689c0.0844727,0.190918,0.7348633,0.5481567,1.0518799,0.6882935  c0.2650757,0.1171875,0.3170776,0.4695435,0.0908813,0.6508179c0,0-0.3075562,0.3934326-1.0962524,1.1033325L30.887207,8.2226563  c-0.1367188-0.2392578-0.4414063-0.3232422-0.6826172-0.1855469c-0.2392578,0.137207-0.3227539,0.4428711-0.1855469,0.6826172  l2.2029419,3.8500366c-0.4588623,0.3764648-1.0161133,0.8080444-1.6887207,1.2913208  c-2.7848511,2.0009766-4.5722656,3.0811157-5.1965332,3.4450684l-4.0784302,1.3761597  c-2.1879883-0.1018066-4.1372681,0.0525513-5.1923828,0.1687622c-0.6225586,0.0688477-1.1499023,0.5004883-1.3432617,1.0991211  l-0.3408813,1.0521851l-7.0872803,2.3919067L6.6860352,23.164856L12.1386108,21.2506714z M6.5281982,27.3063354  c0.4990234-0.6463623,0.0587158-2.8921509-0.1243896-3.713501l0.6589355,0.2485352  c0.1308594,0.902771,0.3439941,2.9810181,0.0197754,3.680603c-0.2630615,0.567688-1.2139282,1.1541138-1.65625,1.3859863  l-0.6964722-0.2438965C5.2145386,28.5081787,5.8525391,28.1815186,6.5281982,27.3063354z M13.3410034,33.9989014  l-0.0951538,5.9711914l0.2103882,0.4358521c0,0,0.4699707,0.774231,0.2705078,1.0369263  c-0.2005005,0.2640991-0.5906372,0.3970947-0.9789429,0.3970947c-0.3640137,0-0.7263794-0.1168213-0.9296875-0.3519897  c-0.2097168-0.2426758,0.1352539-1.0219116,0.1352539-1.0219116l0.0651245-0.4959717l-1.3544922-6.6958618l-6.3568726-1.5061646  l0.0013428-2.5598145c-0.0039063-0.0540161,0.0026855-0.1065674,0.0148315-0.1571045l0.8729858,0.3057251v1.7803345  l29.5717773,6.7734375v-1.8200073l1.0253906,0.1818237v3.0861206l-1.2088013-0.2514648L13.3410034,33.9989014z   M36.7557373,47.7454834c-0.1581421,0.1471558-0.4871216,0.2156372-0.845459,0.2156372  c-0.5595093,0-1.1906128-0.1669312-1.3544312-0.461853c-0.2203369-0.3966675,0.5109863-1.5178833,0.5109863-1.5178833  l-0.0751953-0.871582l-0.2335815-5.4562378l1.0354004,0.2153931v0.0114136l1.0869141-1.0429688l-0.4716797,7.3535156  l0.0108032,0.0006714l-0.0001221,0.0002441C36.4193726,46.1918335,37.0623779,47.4602051,36.7557373,47.7454834z   M40.7236938,31.5918579c-0.0338135,0.4501953-0.1676025,0.887207-0.3916016,1.2792358l-1.0122681,1.9894409l-1.0119019,1.923584  l-1.2883301,7.6935425l0.4418335-6.8912354l-1.1679688,1.1210938v-2.5722656  c0.2001953-0.3208008,1.0761719-1.7729492,1.4648438-3.2241211c0.4516602-1.6875,0.3666992-4.4755859,0.3432617-5.0537109  l3.1708374-3.5705566L40.7236938,31.5918579z M22.5150146,32.8457642l2.5478516-1.9261475l0.4119873,0.0870972l-2.4413452,1.9501343  L22.5150146,32.8457642z M23.0892944,32.9589233l2.5478516-1.9261475l0.4119873,0.0870972l-2.4413452,1.9501343  L23.0892944,32.9589233z M23.6625977,33.0947266l2.5478516-1.9261475l0.4119873,0.0870972l-2.4413452,1.9501343  L23.6625977,33.0947266z M19.0518188,32.0586548l2.4906616-1.8134766l0.4119873,0.0870972l-2.3841553,1.8374634  L19.0518188,32.0586548z M19.6260986,32.171814l2.4906616-1.8134766l0.4119873,0.0870972l-2.3841553,1.8374634L19.6260986,32.171814  z M20.1994019,32.3075562l2.4906616-1.8134155l0.4119873,0.0870361l-2.3841553,1.8374634L20.1994019,32.3075562z   M15.6264648,31.309082l2.586792-1.6830444l0.4119873,0.0870972l-2.4802856,1.7070313L15.6264648,31.309082z M16.2007446,31.4222412  l2.586792-1.6830444l0.4119873,0.0870972l-2.4802856,1.7070313L16.2007446,31.4222412z M16.7740479,31.5580444L19.3609009,29.875  l0.4119263,0.0870972l-2.4802856,1.7070313L16.7740479,31.5580444z M12.4708252,30.5946045l2.7436523-1.5073853l0.4119873,0.0870972  l-2.637207,1.5313721L12.4708252,30.5946045z M13.0328369,30.7284546l2.6703491-1.5355835l0.4119873,0.0870361l-2.5639038,1.5596313  L13.0328369,30.7284546z M13.5882568,30.8564453l2.6118774-1.5620728l0.4119263,0.0870361l-2.5053101,1.5861206  L13.5882568,30.8564453z M10.3684692,30.1392212l2.6199341-1.5036011l0.4052124,0.0918579l-2.4918213,1.512146  L10.3684692,30.1392212z M9.8117065,30.0322876l2.6779785-1.4951782l0.4146118,0.0861816l-2.6119385,1.5159302L9.8117065,30.0322876  z M10.9547729,30.2523193l2.4887085-1.5084229l0.4440308,0.0675659l-2.5596924,1.5057373L10.9547729,30.2523193z   M9.0957642,29.8777466l-0.5187988-0.1099243l2.838623-1.4586182l0.4119873,0.0870972L9.0957642,29.8777466z M9.1610718,29.8964844  l2.703186-1.4842529l0.4089355,0.090332l-2.6121216,1.5143433L9.1610718,29.8964844z M24.7063599,33.2757568l2.538208-1.9104614  l0.4119873,0.0870972l-2.4317627,1.9344482L24.7063599,33.2757568z M25.3286743,33.4078369l2.538269-1.9104004l0.4119873,0.0870361  l-2.4317627,1.9344482L25.3286743,33.4078369z M21.0151367,32.5160522l2.5171509-1.8898315l0.4119873,0.0870972  l-2.4106445,1.9138184L21.0151367,32.5160522z M21.6375122,32.6481323l2.5170898-1.8898315l0.4119873,0.0870972  l-2.4106445,1.9138184L21.6375122,32.6481323z M17.6257324,31.7429199l2.5385132-1.7493896l0.4119873,0.0870972  l-2.4320679,1.7733765L17.6257324,31.7429199z M18.2480469,31.875061l2.5385742-1.7494507l0.4119873,0.0870972l-2.4320679,1.7734375  L18.2480469,31.875061z M14.2802124,30.9966431l2.6931152-1.5623779l0.4119873,0.0870972l-2.5866699,1.5863647  L14.2802124,30.9966431z M14.8459473,31.1287231l2.6481934-1.5847778l0.4119873,0.0870972l-2.541687,1.6087646  L14.8459473,31.1287231z M11.4560547,30.3624268l2.6809082-1.505249l0.4119263,0.0870361l-2.7173462,1.5148315  L11.4560547,30.3624268z M11.8810425,30.4656982l2.7764282-1.4991455l0.4119263,0.0870972l-2.6698608,1.5231323  L11.8810425,30.4656982z M26.387085,33.6290283l2.3721924-1.9780273l0.4119873,0.0870972l-2.2657471,2.0020142L26.387085,33.6290283  z M27.0320435,33.776123l2.3722534-1.9780273l0.4119263,0.0870972l-2.265686,2.0020142L27.0320435,33.776123z   M27.6883545,33.9483643l2.4013672-2.0215454l0.4119873,0.0870972l-2.2949219,2.0455322L27.6883545,33.9483643z   M28.7592773,34.1397095l2.2489014-2.03479l0.4119873,0.0870361l-2.142395,2.0588379L28.7592773,34.1397095z M29.4834595,34.2981567  l2.1998291-2.0783691l0.4119873,0.0870361l-2.0933228,2.102417L29.4834595,34.2981567z M30.5471191,34.5018311l2.1508179-2.1029663  l0.4119873,0.0870972l-2.0443115,2.1269531L30.5471191,34.5018311z M31.3391724,34.6375732l2.0075073-2.1219482l0.4119873,0.0870972  l-1.901001,2.1459351L31.3391724,34.6375732z M32.0482788,34.8095703l1.9697876-2.1655273l0.4119873,0.0870972l-1.8632813,2.1895142  L32.0482788,34.8095703z"/></svg>,
  cello: <svg width="50" height="62.5" viewBox="0 0 50 62.5"><path d="M20.6535645,32.475708c0.4788818,0.4060669,0.4868164,1.0379028,0.2749634,1.6578369  c-0.3824463,1.1188965-2.4310913,2.0648804-2.8764648,3.5863647c-0.0900879,0.3076172-0.1592407,0.9951172,0.1149902,1.1611328  c0.227478,0.1376953,0.3999634,0.0853882,0.5007324,0.0308838c-0.1239014-0.142334-0.1225586-0.3561401,0.0125122-0.4921265  c0.1412354-0.142334,0.3711548-0.1432495,0.5135498-0.0018921c0.1344604,0.1334229,0.1380005,0.3438721,0.0194092,0.4869385  l0.0057373,0.0006714c0,0-0.4133911,0.871521-1.2440796,0.3703613c-0.3998413-0.241272-0.7926025-0.7633057-0.6275024-1.6675415  c0.2086182-1.1428833,1.8640747-2.5148926,2.7542114-3.461853c0.2940674-0.3128052,0.7527466-0.7891235,0.3514404-1.3151245  c-0.0802002-0.1051636-0.164856-0.1445313-0.244873-0.164856c0.0311279,0.1200562,0.0059204,0.2518921-0.0877686,0.3463135  c-0.1412964,0.142334-0.3712769,0.1431274-0.5135498,0.0018921c-0.142395-0.1413574-0.1431885-0.3712769-0.0018921-0.5136108  c0.0463257-0.0466919,0.1032715-0.0724487,0.1624146-0.088623l-0.0031128-0.0048828  C19.7642822,32.4075928,20.3297729,32.2011108,20.6535645,32.475708z M15.7425537,29.819397  c0.3106689-0.2963867,0.7836304-0.7585449,1.312561-0.361145c0.1057129,0.0794067,0.145752,0.1638184,0.166626,0.2437134  c-0.1202393-0.0302734-0.2518921-0.0040894-0.3456421,0.090271c-0.1412964,0.142334-0.1404419,0.3723145,0.0018921,0.5136108  c0.142395,0.1412964,0.3723145,0.1403809,0.5135498-0.0018921c0.0463867-0.0467529,0.0717163-0.1038208,0.0875244-0.163147  l0.0048218,0.0031128c0,0,0.2023315-0.5669556-0.074585-0.8887939c-0.4096069-0.4758911-1.0415039-0.479126-1.6598511-0.2626953  c-1.1160889,0.390625-2.046936,2.446167-3.5651245,2.90271c-0.3070068,0.0923462-0.9939575,0.1665039-1.1619263-0.1064453  c-0.1393433-0.2265015-0.0883789-0.399353-0.0345459-0.5004883c0.1431885,0.1228027,0.3569946,0.119873,0.4920044-0.0161133  c0.1412964-0.142334,0.1404419-0.3722534-0.0018921-0.5136108c-0.1344604-0.1334229-0.3449097-0.135498-0.4870605-0.0158081  l-0.0007935-0.0057373c0,0-0.8684082,0.4197998-0.3612061,1.2467651c0.2442017,0.3980713,0.769165,0.7869873,1.6721191,0.6152344  C13.4423828,32.381958,14.8021851,30.7164307,15.7425537,29.819397z M49.1575317,4.3496094  c0.0322876,0.4594116-0.2533569,0.8815308-0.6918335,1.0223389l-1.8286743,0.5871582l-0.8271484,1.0602417l0.6749268,0.6749268  c0.0162354-0.0010376,0.0299683-0.0093994,0.0464478-0.0093994c0.4213867,0,0.7630005,0.3416138,0.7630005,0.7630615  c0,0.4213867-0.3416138,0.7630005-0.7630005,0.7630005s-0.7630005-0.3416138-0.7630005-0.7630005  c0-0.0166016,0.0083618-0.0304565,0.0093994-0.0467529l-0.5875244-0.5875244l-0.6223145,0.7976074l0.5873413,0.5873413  c0.0235596-0.0021973,0.0439453-0.0137329,0.0680542-0.0137329c0.4214478,0,0.7630615,0.3416138,0.7630615,0.7630615  c0,0.4213867-0.3416138,0.7630005-0.7630615,0.7630005c-0.4213867,0-0.7630005-0.3416138-0.7630005-0.7630005  c0-0.0089111,0.0047607-0.0162964,0.0050659-0.0251465l-0.5171509-0.5171509l-0.065918,0.0844727  C43.6924438,9.7332764,43.4014893,9.875,43.093811,9.875c-0.0070801,0-0.0142212-0.000061-0.0213623-0.0002441l-0.1637573-0.003479  l-11.225708,11.8868408c1.3057251,1.7694702,2.4759521,4.1726074,1.8178101,6.6124268  c-0.5715942,2.1189575-2.7122803,3.9476929-4.2753296,5.2828979l-0.1480713,0.1265259  c-1.0100098,0.8640137-1.2358398,1.3582153-1.269165,1.4431152c-0.0620117,0.357605-0.3146362,0.6572266-0.6638794,0.7757568  c-0.1054077,0.0358276-0.2138672,0.0531006-0.321228,0.0531006c-0.28479,0-0.5621948-0.1218262-0.7556152-0.3447876  c-0.1914063-0.2206421-0.7127075-0.6747437-1.0504761-0.7244873c-0.0536499-0.0078735-0.1063232-0.0117798-0.1580811-0.0117798  c-0.6150513,0-1.2918091,0.55896-2.0688477,1.7088623c-0.5015259,0.7420654-0.8189697,2.0298462-0.6643677,2.3302612  c0.2382202,0.3040771,0.7590332,0.4854736,0.9161377,0.5234985c0.4248047,0.0963745,0.7383423,0.456665,0.7751465,0.8907471  c0.0368652,0.434021-0.2116089,0.84198-0.6141357,1.0084839c-0.2613525,0.1081543-1.0933838,0.5333252-1.4746704,1.0507202  c-0.1167603,0.1583862-0.2684937,0.5610352-0.4152222,0.9503784c-0.4661255,1.2369995-1.1705933,3.1064453-3.1421509,4.4432983  c-1.2191162,0.8266602-2.8439331,1.2819214-4.5750732,1.2819214c-1.0031738,0-1.977417-0.1575317-2.8173828-0.4556885  c-1.6066284-0.5701294-3.6940308-2.0286255-4.7042236-2.7747192l-2.7316895,1.9190674  C3.168396,47.9699707,2.9675903,48.02948,2.7681274,48.02948c-0.2764893,0-0.550354-0.1143188-0.746582-0.3341675  l-0.1624146-0.1820068c-0.3319702-0.3720093-0.3392334-0.9317627-0.0169678-1.3121948l2.0800781-2.4556274  c-0.7380981-1.0244141-2.0761108-2.9924927-2.5186768-4.3719482c-0.6672363-2.0800171-0.6835327-5.163208,0.7842407-7.3623657  c1.3223877-1.9813232,3.1865845-2.6995239,4.420105-3.1747437c0.3883057-0.1495361,0.7897949-0.3042603,0.9473877-0.4221802  c0.5096436-0.3814697,0.9240723-1.2011108,1.0397339-1.4823608c0.1538086-0.3796387,0.5219727-0.6245728,0.9263916-0.6245117  c0.0257568,0,0.0516357,0.0009766,0.0775757,0.0029907c0.4342651,0.0335693,0.796875,0.3444214,0.8964233,0.7684937  c0.0286255,0.1219482,0.2128906,0.6674805,0.5175171,0.9038696c0.0006714,0.0003662,0.0674438,0.0334473,0.2523193,0.0334473  c0.6228027,0,1.5990601-0.3723145,2.0857544-0.7064209c1.2330933-0.8465576,1.7828979-1.5791016,1.6806641-2.239502  c-0.0499268-0.3226929-0.4681396-0.8157959-0.7322388-1.0449829c-0.30896-0.2640381-0.4274292-0.6889038-0.2996216-1.074707  c0.1159668-0.3500977,0.4138184-0.6049194,0.7709351-0.6695557c0.0847168-0.0339966,0.5772095-0.2634277,1.4337158-1.2797241  l0.1253662-0.1489258c1.3237305-1.5728149,3.1366577-3.7269287,5.2514648-4.3140869  c0.4718628-0.1309814,0.9671631-0.1973877,1.4720459-0.1973877c1.9556885,0.0001831,3.8028564,0.9833374,5.1693726,1.9760132  L39.7330322,7.2307739l-0.0010986-0.0064697c-0.0580444-0.3540039,0.0780029-0.7120361,0.3565674-0.9381714l0.8704224-0.706604  l-0.5982056-0.5982056c-0.0161743,0.0010376-0.0299072,0.0093384-0.0463867,0.0093384  c-0.4213867,0-0.7630005-0.3416138-0.7630005-0.7630005s0.3416138-0.7630005,0.7630005-0.7630005  c0.4214478,0,0.7630615,0.3416138,0.7630615,0.7630005c0,0.0166016-0.0084229,0.0304565-0.0094604,0.046814l0.6714478,0.6714478  l0.9194946-0.746521L41.9837646,3.524292c-0.0162354,0.0010376-0.0299683,0.0093994-0.0464478,0.0093994  c-0.4213867,0-0.7630005-0.3416138-0.7630005-0.7630615c0-0.4213867,0.3416138-0.7630005,0.7630005-0.7630005  s0.7630005,0.3416138,0.7630005,0.7630005c0,0.0166016-0.0083618,0.0304565-0.0093994,0.0467529l0.7484131,0.7484131  l0.4286499-0.3479614l0.5772705-1.8381348c0.1315308-0.4188843,0.5194702-0.7003784,0.9535522-0.7003784  c0.0215454,0,0.0432129,0.0006714,0.0648804,0.0020752l2.5795898,0.1664429  c0.4993896,0.0322266,0.8980103,0.4285889,0.9331665,0.9277344L49.1575317,4.3496094z M6.0452881,44.7268677  c0.7792969-0.8469849,3.9453125-4.2741699,4.5299072-4.6931763c0.5371094-0.3852539,1.15625-0.578125,1.6083984-0.7192383  c0.2099609-0.0654297,0.4091797-0.1274414,0.4951172-0.1796875c1.1972656-0.7294922,1.90625-1.3745117,2.1992188-1.6679688  l-2.2490234-2.2324219c-0.2529297,0.3017578-0.7880859,0.9921875-1.5527344,2.2529297  c-0.1318359,0.2167969-0.2294922,0.5087891-0.3339844,0.8178711c-0.1533203,0.4536133-0.3115234,0.9223633-0.6103516,1.3022461  c-0.5151978,0.6540527-4.6844482,4.000061-4.9903564,4.2458496l-2.5362549,2.9942017L2.7676392,47.02948L6.0452881,44.7268677z   M30.6807861,22.0975342l-9.1016846,9.394165l-3.0322266-3.0092773l9.3538818-9.1552734  c-1.2087402-0.9234619-2.9932861-1.986084-4.8474731-1.9862671c-0.4003906,0-0.8033447,0.0495605-1.2044678,0.1609497  c-1.878479,0.5215454-3.6234131,2.6531372-4.8796997,4.1438599c-1.3251343,1.5724487-2.0200195,1.6193237-2.0200195,1.6193237  s0.9393311,0.8026733,1.0708008,1.6523438c0.2209473,1.4274902-1.085022,2.5180054-2.1029053,3.2167969  c-0.5906982,0.4055786-1.7575684,0.882019-2.6517334,0.882019c-0.3377075,0-0.6364136-0.0679321-0.850647-0.2332764  c-0.6673584-0.5151367-0.8927612-1.4755249-0.8927612-1.4755249S9.0078125,28.5761719,8.15448,29.2148438  c-0.9004517,0.6740112-3.5023804,0.9053955-5.1348877,3.3514404c-1.2196655,1.8273926-1.2827759,4.5723877-0.6638184,6.5018311  c0.4315186,1.3452148,1.921814,3.4673462,2.5524902,4.3308716c1.2995605-1.0426025,4.4356689-3.5991211,4.8309937-4.1011353  c0.2460938-0.3115234,0.3896484-0.7392578,0.5292969-1.1523438c0.1132813-0.3364258,0.2197266-0.6533203,0.3798828-0.9169922  c1.1269531-1.8583984,1.7646484-2.5078125,1.7919922-2.5341797l0.1757813-0.1767578l2.9521484,2.9296875l-0.1503906,0.1762695  c-0.03125,0.0361328-0.7753906,0.9003906-2.4794922,1.9379883c-0.1386719,0.0844727-0.3447266,0.1489258-0.6054688,0.2304688  c-0.4199219,0.1303711-0.9951172,0.3095703-1.4667969,0.6479492c-0.4732666,0.3396606-3.1243896,3.182373-4.3807983,4.5475464  c0.8713379,0.6524658,3.0427856,2.2111816,4.6273804,2.7734985c0.7348022,0.2607422,1.5968628,0.3980713,2.4829712,0.3980713  c1.4168091,0,2.8950806-0.3509521,4.013855-1.1095581c2.43396-1.6504517,2.6462402-4.2539673,3.3135986-5.1593628  c0.6323242-0.8580322,1.8973999-1.3814087,1.8973999-1.3814087s-0.9620361-0.2182617-1.4820557-0.881897  c-0.6089478-0.7769165,0.0702515-2.6891479,0.6229858-3.507019c0.6414185-0.9491577,1.6182251-2.1489258,2.8973999-2.1489258  c0.0994873,0,0.2007446,0.0072632,0.303833,0.0224609c0.8505859,0.1252441,1.6601563,1.0585938,1.6601563,1.0585938  s0.0418091-0.6951294,1.6044312-2.0318604c1.4814453-1.2672119,3.6002197-3.027771,4.1079102-4.9099731  C33.1427002,25.8583984,31.8109741,23.5598145,30.6807861,22.0975342z M45.7582397,5.4597778l-1.3787842-1.3690796L40.71875,7.0625  l0.0859985,0.5244141L28.463562,19.4733276l0.0012817,0.0012817l-9.2050781,9.0107422l2.3115234,2.2954102l8.7974243-9.0797119  c-0.0010376-0.0012817-0.0022583-0.0029297-0.0032959-0.0042114L42.4863281,8.8620605L43.09375,8.875L45.7582397,5.4597778z   M48.1599731,4.4197998l-0.1810913-2.5740356L45.399292,1.6793213l-0.6512451,2.0737915l1.3410645,1.331604L48.1599731,4.4197998z   M18.4797974,34.0699463l-2.4985962-2.4802856l-0.6156006,0.1748657l2.9923096,2.9703369L18.4797974,34.0699463z"/></svg>,
}

const timeAccessor = d => d[0]
const headPitchAccessor = d => d[1]
const expressionAccessor = d => d[2]
const MusicStaff = ({ data }) => {
  const timestampDiff = timeAccessor(_.last(data.frame_data)) - timeAccessor(_.first(data.frame_data))
  const xScale = d3.scaleLinear()
    .domain(d3.extent(data.frame_data, timeAccessor))
    .range([0, timestampDiff / 7])
  const yScale = d3.scaleQuantize()
    .domain(d3.extent(data.frame_data, headPitchAccessor))
    .range(_.map(_.times(9), (d, i) => (i * 100) / 8))
    // .range([0, 100])

  return (
    <div className="MusicStaff__wrapper">
      <div className="MusicStaff" style={{width: `${xScale.range()[1] + 140}px`}}>
        <div className="MusicStaff__key">
          <div className="MusicStaff__key__item">
            <svg width="34" height="34" viewBox="0 0 34 34" fill="none" xmlns="http://www.w3.org/2000/svg"> <circle cx="17" cy="17" r="16" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/> <circle cx="21" cy="7" r="1" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/> <circle cx="13" cy="7" r="1" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/> <path d="M25 10C25 13.866 21.4183 17 17 17C12.5817 17 9 13.866 9 10" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/> </svg>
          </div>
          <div className="MusicStaff__key__item">
            <svg width="34" height="34" viewBox="0 0 34 34" fill="none" xmlns="http://www.w3.org/2000/svg"> <circle cx="17" cy="17" r="16" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/> <circle cx="21" cy="19" r="1" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/> <circle cx="13" cy="19" r="1" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/> <path d="M25 22C25 25.866 21.4183 29 17 29C12.5817 29 9 25.866 9 22" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/> </svg>
          </div>
        </div>
        <div className="MusicStaff__clef">
          { icons[data.instrument] }
          {/* <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" class="feather feather-play-circle"><circle cx="12" cy="12" r="10"></circle><polygon points="10 8 16 12 10 16 10 8"></polygon></svg> */}
          {/* <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" class="feather feather-zap"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg> */}
        </div>
        <div className="MusicStaff__notes">
          {_.map(data.frame_data, (d, i) => {
            const isFirst = !data.frame_data[i - 1] || expressionAccessor(data.frame_data[i - 1]) != expressionAccessor(d)
            return (
              <div
                key={i}
                className="MusicStaff__note"
                style={{
                  left: `${xScale(timeAccessor(d))}px`,
                  top: `${yScale(headPitchAccessor(d))}%`,
                  // opacity: isFirst ? 1 : 0.1,
                  zIndex: isFirst ? 2 : 1,
                }}>
                { isFirst ? emoji[expressionAccessor(d)] : "¬∑" }
                {_.includes(data.eyebrows_raised, timeAccessor(d)) && (
                  <div style={{top: isFirst ? "-0.5em" : 0}} className="MusicStaff__note__eyebrow">‚åí</div>
                )}
              </div>
            )
          })}
        </div>

        {_.map(data.eyes_closed, (d, i) => (
          <div
            key={i}
            className="MusicStaff__eye"
            style={{
              left: `${xScale(d)}px`
            }}
          >
            {(data.eyes_closed[i-1] && ((d - data.eyes_closed[i-1]) < 500)) ? "‚Äî" : (
              eyesClosedIcon
            )}
          </div>
        ))}

        {_.map(_.times(5), (d, i) => (
          <div
            key={i}
            className="MusicStaff__line"
            style={{
              top: `${i * 100 / 4}%`
            }}
          />
        ))}
      </div>
    </div>
  )
}

const MusicRadar = ({ data }) => {
  const height = 220
  const width = height
  const radius = width / 2 * 0.8

  const expressionCounts = _.map(data, piece => (
    _.map(emoji, (emoji, expression) => ([
      expression,
      (_.filter(piece.frame_data, d => expressionAccessor(d) == expression).length * 100) / piece.frame_data.length
    ]))
  ))

  const radarScale = d3.scaleLinear()
    .domain([0, 76])
    .range([0, radius])

  const angles = _.map(expressionCounts[0], (d,i) => (
    i * ((Math.PI * 2) / expressionCounts[0].length)
  ))

  const lineGenerator = d3.lineRadial()
    .angle((d, i) => angles[i])
    .radius((d, i) => radarScale(d[1]))
    .curve(d3.curveLinearClosed)

  return (
    <svg className="MusicRadar" height={height} width={width}>
      {_.map(angles, angle => (
        <line
          className="MusicRadar__grid-line"
          x1={width / 2}
          x2={Math.cos(angle - Math.PI * 0.5) * radius + width / 2}
          y1={height / 2}
          y2={Math.sin(angle - Math.PI * 0.5) * radius + height / 2}
          transform={`translate(${height / 2}px, ${width / 2}px)`}
        />
      ))}

      {_.map(_.times(4), i => (
        <circle
          className="MusicRadar__grid-line"
          key={i}
          cx={width / 2}
          cy={height / 2}
          r={radius * (i / 3)}
        />
      ))}

      {_.map(angles, (angle, i) => {
        const x = Math.cos(angle - Math.PI * 0.5) * (radius * 1.1) + width / 2
        const y = Math.sin(angle - Math.PI * 0.5) * (radius * 1.1) + height / 2
        return (
          <text
            className="MusicRadar__label"
            x={x}
            y={y}
            style={{
              textAnchor: i == 0 || i == expressionCounts[0].length / 2 ? "middle" :
                          i < expressionCounts[0].length / 2            ? "start"  :
                                                                      "end"
            }}
          >
            { emoji[expressionCounts[0][i][0]] }
          </text>
        )
      })}

      {_.map(data, (piece, index) => (
          <path
            key={piece.name}
            className="MusicRadar__line"
            d={lineGenerator(expressionCounts[index])}
            style={{
              transform: `translate(${height / 2}px, ${width / 2}px)`,
              stroke: instrumentColors[piece.instrument],
              fill: instrumentColors[piece.instrument],
            }}
          />
      ))}
    </svg>
  )
}